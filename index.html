<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG con JavaScript</title>
</head>
<body>
    <svg id="badge" xmlns="http://www.w3.org/2000/svg" width="132" height="20" role="img" aria-label="Js: JavaScript">
        <linearGradient id="s" x2="0" y2="100%">
            <stop offset="0" stop-color="#bbb" stop-opacity=".1"/>
            <stop offset="1" stop-opacity=".1"/>
        </linearGradient>
        <clipPath id="r">
            <rect width="132" height="20" rx="3" fill="#fff"/>
        </clipPath>
        <g clip-path="url(#r)">
            <rect width="31" height="20" fill="#555"/>
            <rect x="31" width="101" height="20" fill="#F7DF1E"/>
            <rect width="132" height="20" fill="url(#s)"/>
        </g>
        <g fill="#fff" text-anchor="middle" font-family="Verdana,Geneva,DejaVu Sans,sans-serif" text-rendering="geometricPrecision" font-size="110">
            <text aria-hidden="true" x="165" y="150" fill="#010101" fill-opacity="1" transform="scale(.1)">Js</text>
            <text x="165" y="140" transform="scale(.1)" fill="#fff">Js</text>
            <text aria-hidden="true" x="805" y="150" fill="#010101" fill-opacity=".3" transform="scale(.1)">JavaScript</text>
            <text x="805" y="140" transform="scale(.1)" fill="#fff">JavaScript</text>
        </g>
    </svg>

    <script>
        function obtenerValores(name) {
            const pathUrl = new URLSearchParams(window.location.search);
            return pathUrl.get(name);
        }

        function getTextWidth(text, font = "11px Verdana,Geneva,DejaVu Sans,sans-serif") {
            const svgNS = "http://www.w3.org/2000/svg";
            const tempSvg = document.createElementNS(svgNS, "svg");
            tempSvg.setAttribute("width", "0");
            tempSvg.setAttribute("height", "0");
            tempSvg.style.position = "absolute";
            tempSvg.style.visibility = "hidden";
            
            const tempText = document.createElementNS(svgNS, "text");
            tempText.setAttribute("font-family", "Verdana,Geneva,DejaVu Sans,sans-serif");
            tempText.setAttribute("font-size", "11px"); // Effective font size after scaling
            tempText.textContent = text;
            
            tempSvg.appendChild(tempText);
            document.body.appendChild(tempSvg);
            const width = tempText.getComputedTextLength();
            document.body.removeChild(tempSvg);
            return width;
        }

        function generateBadge() {
            var ShortName = 'Js';
            var name = 'JavaScript';
            var backgroundColor = '#F7DF1E';

            if (obtenerValores('shortname') !== null) {
                ShortName = obtenerValores('shortname');
            }

            if (obtenerValores('name') !== null) {
                name = obtenerValores('name');
            }

            if (obtenerValores('color') !== null) {
                backgroundColor = `#${obtenerValores('color')}`;
            }

            const padding = 15; // pixels
            const shortNameActualWidth = getTextWidth(ShortName);
            const nameActualWidth = getTextWidth(name);

            const shortNameTextWidth = shortNameActualWidth + padding;
            const nameTextWidth = nameActualWidth + padding;
            
            const totalWidth = shortNameTextWidth + nameTextWidth;

            const svgElement = document.getElementById('badge');
            svgElement.setAttribute('width', totalWidth.toString());
            svgElement.setAttribute('aria-label', `${ShortName}: ${name}`);

            const clipPathRect = svgElement.querySelector('clipPath rect');
            clipPathRect.setAttribute('width', totalWidth.toString());

            const rects = svgElement.querySelectorAll('g[clip-path="url(#r)"] rect');
            // First rectangle (shortname background)
            rects[0].setAttribute('width', shortNameTextWidth.toString());
            // Second rectangle (name background)
            rects[1].setAttribute('x', shortNameTextWidth.toString());
            rects[1].setAttribute('width', nameTextWidth.toString());
            rects[1].setAttribute('fill', backgroundColor);
            // Third rectangle (gradient overlay)
            rects[2].setAttribute('width', totalWidth.toString());
            
            const textElements = svgElement.querySelectorAll('g[fill="#fff"] text');
            // ShortName Text (shadow and main)
            const shortNameTextX = (shortNameTextWidth / 2) * 10;
            textElements[0].textContent = ShortName;
            textElements[0].setAttribute('x', shortNameTextX.toString());
            textElements[1].textContent = ShortName;
            textElements[1].setAttribute('x', shortNameTextX.toString());
            
            // Name Text (shadow and main)
            const nameTextX = (shortNameTextWidth + (nameTextWidth / 2)) * 10;
            textElements[2].textContent = name;
            textElements[2].setAttribute('x', nameTextX.toString());
            textElements[3].textContent = name;
            textElements[3].setAttribute('x', nameTextX.toString());
        }

        document.addEventListener('DOMContentLoaded', generateBadge);
    </script>
</body>
</html>
